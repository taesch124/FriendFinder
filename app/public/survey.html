<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Friend Finder Survey</title>

    <!-- Jquery-->
    <script src="https://code.jquery.com/jquery.js"></script>

    <!-- Materialize -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <style>
        .card form {
            padding: 0 1rem 2rem 1rem;
        }

        h2 {
            color: white;
        }

        .dropdown-content li > span {
            color: #3f51b5 ;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col m12">
                
                <div class="card">
                    <h2 class="card-panel indigo center-align">Friend Finder Survey</h2>

                    <form class="form" method="POST" role="form">
                        <h4 class="center-align">About Me</h4>
                        
                        <div class="input-field">
                            <i class="material-icons prefix">account_circle</i>
                            <label for="name">Name (Required)</label>
                            <input type="text" id="name" placeholder="Name">
                        </div>

                        <div class="input-field">
                            <i class="material-icons prefix">add_a_photo</i>
                            <label for="profile-image">Image (Required)</label>
                            <input type="text" id="profile-image" placeholder="Image URL">            
                        </div>

                        <h4 class="center-align">Questions</h4>

                        <div class="row">
                            <div class="input-field col m6">
                                <p>1) You like your room/apartment/house to be spotless.</p>
                                <select id="question-1">
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="5">5 (strongly agree)</option>
                                    <option value="4">4</option>
                                    <option value="3">3</option>
                                    <option value="2">2</option>
                                    <option value="1">1 (strongly disagree)</option>
                                </select>
                            </div>

                            <div class="input-field col m6">
                                <p>2) You would rather a night in than going out drinking.</p>
                                <select id="question-2">
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="5">5 (strongly agree)</option>
                                    <option value="4">4</option>
                                    <option value="3">3</option>
                                    <option value="2">2</option>
                                    <option value="1">1 (strongly disagree)</option>
                                </select>
                            </div>
                        </div>

                        
                        <div class="row">
                            <div class="input-field col m6">
                                <p>2) You would rather read a book than watch a movie.</p>
                                <select id="question-3">
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="5">5 (strongly agree)</option>
                                    <option value="4">4</option>
                                    <option value="3">3</option>
                                    <option value="2">2</option>
                                    <option value="1">1 (strongly disagree)</option>
                                </select>
                            </div>
                        </div>
                        
                        
                        <div class="center-align">
                            <button class="btn waves-effect waves-light indigo" type="submit" id="submit-answers">Submit</button>
                        </div>
                    </form>
                </div>

                <a href="/">Home</a>
                |
                <a href="/api/friends">API Friends List</a> 
                | 
                <a href="https://github.com/taesch124/FriendFinder">GitHub Repo</a>
            </div>
        </div>
    </div>  

    <script type="text/javascript">
        var submitted = false;

        $(document).ready(function(){
            $('select').formSelect();
        });

        $('#submit-answers').on('click', function() {
            event.preventDefault();
            if(submitted) return;
            submitted = true;
            
            let choices = $('select');
            let answers = [];
            choices.map((i, e) => answers.push(parseInt(e.value)));

            let newFriend = {
                name: $('#name').val().trim(),
                image: $('#profile-image').val().trim(),
                answers: answers
            }
            
            let baseUrl = window.location.protocol + '//' + window.location.host + '/';

            $.get(baseUrl + 'api/friends') .then(data => {
                $.post(baseUrl + 'api/friends', newFriend).then(data => {
                    console.log('Your new best friend is ' + data.name + '!');
                    alert('Your new best friend is ' + data.name + '!');
                });
            });
            
        });
    </script>
</body>
</html>